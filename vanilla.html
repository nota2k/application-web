<!doctype html>
<html lang="en">
<head>
    <title>Vanilla JS Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.min.css">
</head>

<body>
<main>
    <div>
        <h1>Vanilla JS Example</h1>
        <hr>
        <button id="fetch-users">Fetch Users</button>
        <button id="sort-age">Tri par age</button>
        <button id="sort-gender">Tri par Genre</button>
        <select id="filter">Filtrer
          <option value="all">Tous</option>
          <option value="male">Homme</option>
          <option value="female">Femme</option>
        </select>
        <input type="text" id="search" placeholder="Rechercher">
    </div>
    <table id="tbl-users">
        <thead>
        <tr>
            <th>Photo</th>
            <th>Nom</th>
            <th>Genre</th>
            <th>Age</th>
            <th>Email</th>
            <th>Tel</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</main>

<script>
  
  let allUsers = []

  async function fetchUsers() {
    try {
      const response = await fetch('https://randomuser.me/api/?results=20');
      const { results } = await response.json();
      allUsers = results;
      displayUsers(allUsers);
    } catch (error) {
      console.error('Error fetching users:', error);
    }
  }

  function displayUsers(users){
     const tbody = document.querySelector('#tbl-users tbody');
      tbody.innerHTML = users.map(user => `
        <tr>
            <td><img src="${user.picture.thumbnail}" alt="${user.name.first} Photo"></td>
            <td class="firstname">${user.name.first} ${user.name.last}</td>
            <td class="gender">${user.gender}</td>
            <td class="age">${user.dob.age}</td>
            <td class="email">${user.email}</td>
            <td class="phone">${user.phone}</td>
        </tr>
    `).join('');
  }

  displayUsers(allUsers)

  let ascendant = true;

  function sortAge(allUsers) {
    allUsers.sort((a, b) => {
      return ascendant ? a.dob.age - b.dob.age : b.dob.age - a.dob.age;
    });
    ascendant = !ascendant;
    displayUsers(allUsers);
  }

  function sortGender(allUsers) {
    allUsers.sort((a, b) => {
      const genderA = a.gender;
      const genderB = b.gender;
      return ascendant ? genderA.localeCompare(genderB) : genderB.localeCompare(genderA);
    });

    ascendant = !ascendant;
    displayUsers(allUsers);
  }

  function filterGender(allUsers,e){
    let value = e.target.value;
    value == "all" ? displayUsers(allUsers) : displayUsers(allUsers.filter((user) => user.gender == value));
  }

  function searchInput(allUsers,event){
    let value = event.target.value;
    console.log(value);

    const filteredUsers = allUsers.filter(user => 
      user.name.first.toLowerCase().includes(value.toLowerCase()) || user.name.last.toLowerCase().includes(value.toLowerCase())
    );

    displayUsers(filteredUsers);
  }

  document.getElementById('fetch-users').addEventListener('click', fetchUsers);
  document.querySelector('#sort-age').addEventListener('click', () => sortAge(allUsers))
  document.querySelector('#sort-gender').addEventListener('click', () => sortGender(allUsers))
  document.querySelector('#filter').addEventListener('change', (e) => filterGender(allUsers,e));
  document.querySelector('input#search').addEventListener('keyup', (e) => searchInput(allUsers,e));
</script>
</body>
</html>

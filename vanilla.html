<!doctype html>
<html lang="en">
<head>
    <title>Vanilla JS Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.min.css">
</head>

<body>
<main>
    <div>
        <h1>Vanilla JS Example</h1>
        <hr>
        <button id="fetch-users">Fetch Users</button>
        <button id="sort-age">Tri par age</button>
        <button id="sort-gender">Tri par Genre</button>
        <select id="filter">Filtrer
          <option value="all">Tous</option>
          <option value="male">Homme</option>
          <option value="female">Femme</option>
        </select>
        <input type="text" id="search" placeholder="Rechercher">
    </div>
    <table id="tbl-users">
        <thead>
        <tr>
            <th>Photo</th>
            <th>Nom</th>
            <th>Genre</th>
            <th>Age</th>
            <th>Email</th>
            <th>Tel</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</main>

<script>
  
  let allUsers = []

  async function fetchUsers() {
    try {
      const response = await fetch('https://randomuser.me/api/?results=20');
      const { results } = await response.json();
      allUsers = results;
      displayUsers(allUsers);
    } catch (error) {
      console.error('Error fetching users:', error);
    }
  }

  function displayUsers(users){
     const tbody = document.querySelector('#tbl-users tbody');
      tbody.innerHTML = users.map(user => `
        <tr>
            <td><img src="${user.picture.thumbnail}" alt="${user.name.first} Photo"></td>
            <td class="firstname">${user.name.first} ${user.name.last}</td>
            <td class="gender">${user.gender}</td>
            <td class="age">${user.dob.age}</td>
            <td class="email">${user.email}</td>
            <td class="phone">${user.phone}</td>
        </tr>
    `).join('');
  }

  displayUsers(allUsers)

  let ascendant = true;

  document.querySelector('#sort-age').addEventListener('click', (event) => {
    const tbody = document.querySelector('#tbl-users tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    rows.sort((a, b) => {
      const ageA = parseInt(a.querySelector('.age').textContent);
      const ageB = parseInt(b.querySelector('.age').textContent);
      return ascendant ? ageA - ageB : ageB - ageA;
    });

    ascendant = !ascendant;

    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
  })

  document.querySelector('#sort-gender').addEventListener('click', (event) => {
    const tbody = document.querySelector('#tbl-users tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    rows.sort((a, b) => {
      const genderA = a.querySelector('.gender').textContent;
      const genderB =b.querySelector('.gender').textContent;
      return ascendant ? genderA.localeCompare(genderB) : genderB.localeCompare(genderA);
    });

    ascendant = !ascendant;

    tbody.innerHTML = '';
    rows.forEach(row => tbody.appendChild(row));
  })

  document.querySelector('#filter').addEventListener('change', (event) => {
    const tbody = document.querySelector('#tbl-users tbody');
    const rowsGender = Array.from(tbody.querySelectorAll('tr .gender'));
    let value = event.target.value;
    console.log(value);
    
    rowsGender.forEach(row => {
      if (value === 'all') {
        row.parentElement.style.display = 'table-row';
      } else if (row.textContent !== value) {
        row.parentElement.style.display = 'none';
      } else {
        row.parentElement.style.display = 'table-row';
      }
    });
    
  })

  document.querySelector('input#search').addEventListener('keyup', (event) => {
    console.log(event.target.value);
    const tbody = document.querySelector('#tbl-users tbody');
    const rows = Array.from(tbody.querySelectorAll('tr .firstname'));
    let value = event.target.value;

    if(value === '') {
      rows.forEach(row => {
        row.parentElement.style.display = 'table-row';
      });
    } else {
      rows.forEach(row => {
        if (row.textContent.toLowerCase().includes(value.toLowerCase())) {
          row.parentElement.style.display = 'table-row';
        } else {
          row.parentElement.style.display = 'none';
        }
      });
    }
  })

  document.getElementById('fetch-users').addEventListener('click', fetchUsers);
</script>
</body>
</html>
